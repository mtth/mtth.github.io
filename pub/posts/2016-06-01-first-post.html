<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
</head>
<body>
<h1 id="first-post">First post</h1>
<h2 id="a-new-subtitle">A new subtitle</h2>
<p>And some text.</p>
<p>Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">/* jshint node: true, esversion: 6 */</span>

<span class="st">&#39;use strict&#39;</span><span class="op">;</span>

<span class="kw">const</span> avro <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;../../lib&#39;</span>)<span class="op">,</span>
      path <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;path&#39;</span>)<span class="op">;</span>


<span class="co">/**</span>
<span class="co"> * Load the protocol from its IDL file.</span>
<span class="co"> *</span>
<span class="co"> * </span><span class="kw">@param</span><span class="co"> </span><span class="kw">cb</span><span class="co">(err, protocol) {Function} Callback, called with the parsed</span>
<span class="co"> * protocol as second argument (and eventual error as first).</span>
<span class="co"> */</span>
<span class="kw">function</span> <span class="at">loadProtocol</span>(cb) <span class="op">{</span>
  <span class="kw">const</span> idlPath <span class="op">=</span> <span class="va">path</span>.<span class="at">join</span>(__dirname<span class="op">,</span> <span class="st">&#39;Logger.avdl&#39;</span>)<span class="op">;</span>
  <span class="va">avro</span>.<span class="at">assemble</span>(idlPath<span class="op">,</span> <span class="op">{</span><span class="dt">oneWayVoid</span><span class="op">:</span> <span class="kw">true</span><span class="op">},</span> (err<span class="op">,</span> attrs) <span class="op">=&gt;</span> <span class="op">{</span>
    <span class="cf">if</span> (err) <span class="op">{</span>
      <span class="at">cb</span>(err)<span class="op">;</span>
      <span class="cf">return</span><span class="op">;</span>
    <span class="op">}</span>

    <span class="kw">const</span> logicalTypes <span class="op">=</span> <span class="op">{</span><span class="st">&#39;timestamp-millis&#39;</span><span class="op">:</span> DateType<span class="op">};</span>
    <span class="kw">let</span> protocol<span class="op">;</span>
    <span class="cf">try</span> <span class="op">{</span>
      protocol <span class="op">=</span> <span class="va">avro</span>.<span class="at">parse</span>(attrs<span class="op">,</span> <span class="op">{</span>logicalTypes<span class="op">}</span>)<span class="op">;</span>
    <span class="op">}</span> <span class="cf">catch</span> (err) <span class="op">{</span>
      <span class="at">cb</span>(err)<span class="op">;</span>
      <span class="cf">return</span><span class="op">;</span>
    <span class="op">}</span>
    <span class="at">cb</span>(<span class="kw">null</span><span class="op">,</span> protocol)<span class="op">;</span>
  <span class="op">}</span>)<span class="op">;</span>
<span class="op">}</span>

<span class="co">/**</span>
<span class="co"> * Custom class used to serialize JavaScript date objects.</span>
<span class="co"> */</span>
<span class="kw">class</span> DateType <span class="kw">extends</span> <span class="va">avro</span>.<span class="va">types</span>.<span class="at">LogicalType</span> <span class="op">{</span>
  <span class="at">_fromValue</span>(val) <span class="op">{</span> <span class="cf">return</span> <span class="kw">new</span> <span class="at">Date</span>(val)<span class="op">;</span> <span class="op">}</span>
  <span class="at">_toValue</span>(val) <span class="op">{</span> <span class="cf">return</span> <span class="op">+</span>val<span class="op">;</span> <span class="op">}</span>
<span class="op">}</span>


<span class="va">module</span>.<span class="at">exports</span> <span class="op">=</span> <span class="op">{</span>
  <span class="dt">loadProtocol</span><span class="op">:</span> loadProtocol
<span class="op">};</span></code></pre></div>
</body>
</html>
